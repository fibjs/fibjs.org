# fibjs ä¸­ X509 è¯ä¹¦çš„ä½¿ç”¨

## æ–¹å¼ä¸€: ä½¿ç”¨ä¸´æ—¶ç”Ÿæˆè‡ªç­¾å‘è¯ä¹¦

```js
const CYPT = require('crypto');
const SSLX = require('ssl');
const HTTP = require("http");
```

**1.åˆ›å»ºä¸€ä¸ªå¯†é’¥å¯¹è±¡, å¹¶ç”Ÿæˆ2048ä½RSAå¯†é’¥å¯¹**

```js
let pky = new CYPT.PKey();  
pky.genRsaKey(2048); 
```        


**2.åˆ›å»ºè¯ä¹¦è¯·æ±‚å¯¹è±¡, ç”¨åˆ°äº†ä¸Šé¢ pky ä¸­çš„å…¬é’¥**

```js
let xrq = new CYPT.X509Req("CN=localhost,O=fibjs", pky);


/**
 * CN=localhost æ˜¯è¯ä¹¦çš„ä¸»é¢˜åç§°, å°±æ˜¯è¯ä¹¦çš„ä½¿ç”¨è€…ï¼ˆä¸€èˆ¬æ˜¯åŸŸå
 * å¯ä»¥åŠ ä¸€äº›æ‰©å±•å†…å®¹, æ¯”å¦‚ O=IBM,OU=IT,...ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ç­‰é¡¹
 */
```


**3.ç­¾å‘è¯ä¹¦, ç”¨åˆ° pky ä¸­çš„ç§é’¥**

```js
let opt = {
  notBefore: new Date('2019-01-01') // è¯ä¹¦ç”Ÿæ•ˆæ—¶é—´
 ,notAfter:  new Date('2029-12-31') // è¯ä¹¦å¤±æ•ˆæ—¶é—´
};
let crt = xrq.sign("CN=myy.mkx", pky, opt); 

// CN=myy.mkx æ˜¯è¯ä¹¦çš„ç­¾å‘è€…, åŒæ ·å¯æ·»åŠ æ‰©å±•
// opt å‚æ•°å‚è§ fibjs æ–‡æ¡£
```

**4. ä½¿ç”¨ä¸´æ—¶è¯ä¹¦å¯åŠ¨httpsæœåŠ¡**

```js
var svr = new HTTP.HttpsServer(crt, pky, 443, (req)=> {
  req.response.write('<h1>fibjs https server</h1>');
});
svr.start();
```


**5. æµè§ˆå™¨è®¿é—® https://localhost/ æµ‹è¯•, å› ä¸ºä¸æ˜¯æ­£å¼çš„è¯ä¹¦, æµè§ˆå™¨ä¸ä¼šè®¤, éœ€è¦æ‰‹åŠ¨ç»§ç»­è®¿é—®, ç‚¹å‡»åœ°å€æ è¯ä¹¦å›¾æ ‡å¯æŸ¥çœ‹è¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯ã€‚**

-----
## æ–¹å¼äºŒ: ç”Ÿæˆå’Œä½¿ç”¨è‡ªç­¾å‘è¯ä¹¦æ–‡ä»¶


**1. ç”Ÿæˆè¯ä¹¦/ç§é’¥æ–‡ä»¶**
```js
const fs = require('fs');

//...(åŒä¸Šé¢æ–¹å¼ä¸€çš„1ã€2ã€3æ­¥éª¤, çœç•¥)...

let ks = pky.exportPem();   // å¯¼å‡ºç§é’¥æ–‡æœ¬
let cs = crt.dump(true)[0]; // å¯¼å‡ºè¯ä¹¦æ–‡æœ¬, æ•°ç»„ï¼ˆåªæœ‰ä¸€é¡¹ï¼‰

fs.writeTextFile('d:/mycert.key', ks); // ä¿å­˜ç§é’¥
fs.writeTextFile('d:/mycert.pem', cs); // ä¿å­˜è¯ä¹¦
```

**2. ä½¿ç”¨è¯ä¹¦/ç§é’¥æ–‡ä»¶**

```js
const CYPT = require('crypto');
const SSLX = require('ssl');
const HTTP = require("http");

let pky = new CYPT.PKey();      
let crt = new CYPT.X509Cert();  

pky.importFile('d:/mycert.key'); // è¯»å–keyæ–‡ä»¶
crt.loadFile('d:/mycert.pem');   // è¯»å–pemæ–‡ä»¶

var svr = new HTTP.HttpsServer(crt, pky, 443, (req)=> {
  req.response.write('<h1>fibjs https server</h1>');
});
svr.start();
```

## æ–¹å¼ä¸‰: ä½¿ç”¨å·²æœ‰çš„è¯ä¹¦

ä»¥ä¸Šè½½å…¥è¯ä¹¦æ–‡ä»¶çš„æ–¹æ³•, ä¹Ÿå¯ç”¨äºæ­£å¼è¯ä¹¦, æ¯”å¦‚

- ä»é˜¿é‡Œäº‘ç”³è¯·çš„å…è´¹è¯ä¹¦ï¼ˆä¸‹è½½otheræ ¼å¼, åŒ…å« xxx.pem å’Œ xxx.key ä¸¤ä¸ªæ–‡ä»¶).
- é€šè¿‡ certbot ç”³è¯·å¾—åˆ°çš„è¯ä¹¦.

å…¶ä»–æ ¼å¼çš„è¯ä¹¦å¯èƒ½éœ€è¦è½¬æ¢, å…·ä½“è¯·å‚è€ƒ fibjs çš„æ–‡æ¡£ã€‚

ğŸ‘‰ ã€[æ·»åŠ  native æ¨¡å—](contribute.md)ã€‘